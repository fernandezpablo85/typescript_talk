<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/blood.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
	<style>
		.light {
			opacity: 0.3;
		}

		.hide {
			visibility: hidden;
		}

		.blood {
			color: #a23 !important;
		}

		.gray {
			color: darkgray !important;
		}

		.gold {
			color: gold;
		}

		.reveal section img.custom_image {
			border: none;
			box-shadow: none;
			background: transparent;
		}

		.reveal pre {
			box-shadow: none;
		}

		img.custom_image {
			width: 300px;
		}

		img.custom_image.large {
			width: 500px;
		}

		section table.center tr td {
			text-align: center;
		}

		section table.center tr td:first-child {
			text-align: left;
		}

		pre span.blue {
			color: deepskyblue;
		}

		span.blue {
			color: deepskyblue !important;
		}

		pre span.pink {
			color: palevioletred;
		}

		span.pink {
			color: palevioletred;
		}
	</style>

</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h2>HACIENDO QUE LOS ESTADOS INVALIDOS (DE JAVASCRIPT) SEAN IMPOSIBLES DE REPRESENTAR</h2>
				<aside class="notes">
					<ul>
						<li>Yaron Minski: haciendo que los estados ilegales sean imposibles de representar</li>
					</ul>
				</aside>

			</section>
			<section>
				<h2>HACIENDO QUE LOS <span class="blood">ESTADOS INVALIDOS</span> (DE JAVASCRIPT) SEAN IMPOSIBLES DE
					REPRESENTAR</h2>
				<aside class="notes">
					<ul>
						<li>una combinaci칩n de datos e instrucciones del programa que va a terminar en un
							error.</li>
						<li>La violaci칩n de un invariante</li>
					</ul>
				</aside>

			</section>
			<section>
				<h3>UN PROGRAMA COMO UNA M츼QUINA DE ESTADOS</h3>
				<img class="custom_image large" src="./images/states.svg">
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre>
					<code class="scala"  data-trim data-line-numbers="1">
							case class Person(fname: String, lname: String)
	
							/* this is fine */
							val p = Person("pablo", "fernandez") 
	
							/* this compiles but is invalid */
							val invalid = Person("pablo", null) 

							/* this would not compile */
							val incomplete = Person("pablo")
					</code>
				</pre>
				<img style="visibility: hidden" class="custom_image" src="./images/invalid.transition.svg">
				<aside class="notes">
					<ul>
						<li>esto funciona porque en scala Null es de tipo `scala.Null` y este "hereda" de todos los
							tipos</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre>
						<code class="scala"  data-trim data-line-numbers="3,4">
							case class Person(fname: String, lname: String)
	
							/* this is fine */
							val p = Person("pablo", "fernandez") 
	
							/* this compiles but is invalid */
							val invalid = Person("pablo", null) 

							/* this would not compile */
							val incomplete = Person("pablo") 
						</code>
					</pre>
				<img class="custom_image" src="./images/valid.transition.svg">
				<aside class="notes">
					<ul>
						<li>esto funciona porque en scala Null es de tipo `scala.Null` y este "hereda" de todos los
							tipos</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre>
							<code class="scala"  data-trim data-line-numbers="6,7">
								case class Person(fname: String, lname: String)
		
								/* this is fine */
								val p = Person("pablo", "fernandez") 
		
								/* this compiles but is invalid */
								val invalid = Person("pablo", null)
								
								/* this would not compile */
								val incomplete = Person("pablo") 
							</code>
						</pre>
				<img class="custom_image" src="./images/long.invalid.transition.svg">
				<aside class="notes">
					<ul>
						<li>esto funciona porque en scala Null es de tipo `scala.Null` y este "hereda" de todos los
							tipos</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre>
								<code class="scala"  data-trim data-line-numbers="9,10">
									case class Person(fname: String, lname: String)
			
									/* this is fine */
									val p = Person("pablo", "fernandez") 
			
									/* this compiles but is invalid */
									val invalid = Person("pablo", null)
									
									/* this would not compile */
									val incomplete = Person("pablo") 
								</code>
							</pre>
				<img class="custom_image" src="./images/impossible.transition.svg">
				<aside class="notes">
					<ul>
						<li>esto funciona porque en scala Null es de tipo `scala.Null` y este "hereda" de todos los
							tipos</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="javascript" data-line-numbers="1-7">
						function add(a, b) { 
							return a + b;
						}
						
						add(1, 2); /* ok */
	
						add("1", "2"); /* ok ? '12' */
	
						add("1", 2); /* returns '12' (string), probably invalid */
	
						add(1); /* invalid state: returns NaN */
	
						add(1, 2, 3); /* returns 3 (number), probably invalid */
				</code></pre>
				<img class="custom_image" src="./images/valid.transition.svg">
				<aside class="notes">
					<ul>
						<li>Domain - the set of "input" or argument values for which the function is defined</li>
						<li>Range - the set of values the function takes on as output</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="javascript" data-line-numbers="1-3, 9">
						function add(a, b) { 
							return a + b;
						}
						
						add(1, 2); /* ok */
	
						add("1", "2"); /* ok ? '12' */
	
						add("1", 2); /* returns '12' (string), probably invalid */
	
						add(1); /* invalid state: returns NaN */
	
						add(1, 2, 3); /* returns 3 (number), probably invalid */
					</code></pre>
				<img class="custom_image" src="./images/long.invalid.transition.svg">
				<aside class="notes">
					<ul>
						<li>Domain - the set of "input" or argument values for which the function is defined</li>
						<li>Range - the set of values the function takes on as output</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="javascript" data-line-numbers="1-3, 11, 13">
							function add(a, b) { 
								return a + b;
							}
							
							add(1, 2); /* ok */
		
							add("1", "2"); /* ok ? '12' */
		
							add("1", 2); /* returns '12' (string), probably invalid */
		
							add(1); /* invalid state: returns NaN */
		
							add(1, 2, 3); /* returns 3 (number), probably invalid */
						</code></pre>
				<img class="custom_image" src="./images/long.invalid.transition.svg">
				<aside class="notes">
					<ul>
						<li>Domain - the set of "input" or argument values for which the function is defined</li>
						<li>Range - the set of values the function takes on as output</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="python" data-line-numbers="1-3, 4, 6">
						def add(a, b):
							return a + b
						
						add(1, 2)
	
						add("1", "2")

						add("1", 2) "runtime exception"

						add(1) "runtime exception"

						add(1, 2, 3) "runtime exception"
				</code></pre>
				<img class="custom_image" src="./images/valid.transition.svg">
				<aside class="notes">
					<ul>
						<li>Algunas transiciones lanzan directamente la excepci칩n, otras dejan los datos en un estado
							"corrupto" que eventualmente terminar치 en excepci칩n</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="python" data-line-numbers="8, 10, 12">
							def add(a, b):
								return a + b
							
							add(1, 2)
		
							add("1", "2")
	
							add("1", 2) "runtime exception"
	
							add(1) "runtime exception"
	
							add(1, 2, 3) "runtime exception"
					</code></pre>
				<img class="custom_image" src="./images/invalid.immediate.svg">
				<aside class="notes">
					<ul>
						<li>Algunas transiciones lanzan directamente la excepci칩n, otras dejan los datos en un estado
							"corrupto" que eventualmente terminar치 en excepci칩n</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="java" data-line-numbers="1-3, 5">
						public static Integer add(Integer a, Integer b) {
							return a + b;
						}
							
						add(1, 2);

						add("1", "2"); /* doesn't compile */

						add("1", 2); /* doesn't compile */

						add(1); /* doesn't compile */

						add(1, 2, 3); /* doesn't compile */
						
						add(1, null); /* invalid state: runtime exception */
						</code></pre>
				<img class="custom_image" src="./images/valid.transition.svg">
				<aside class="notes">
					<ul>
						<li>usando primitivos no compilar칤a el 칰ltimo ejemplo</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="java" data-line-numbers="7, 9, 11, 13">
							public static Integer add(Integer a, Integer b) {
								return a + b;
							}
								
							add(1, 2);
	
							add("1", "2"); /* doesn't compile */
	
							add("1", 2); /* doesn't compile */
	
							add(1); /* doesn't compile */
	
							add(1, 2, 3); /* doesn't compile */
							
							add(1, null); /* invalid state: runtime exception */
							</code></pre>
				<img class="custom_image" src="./images/impossible.transition.svg">
				<aside class="notes">
					<ul>
						<li>usando primitivos no compilar칤a el 칰ltimo ejemplo</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Invariantes</h3>
				<pre><code  data-trim class="java" data-line-numbers="15">
								public static Integer add(Integer a, Integer b) {
									return a + b;
								}
									
								add(1, 2);
		
								add("1", "2"); /* doesn't compile */
		
								add("1", 2); /* doesn't compile */
		
								add(1); /* doesn't compile */
		
								add(1, 2, 3); /* doesn't compile */
								
								add(1, null); /* invalid state: runtime exception */
								</code></pre>
				<img class="custom_image" src="./images/invalid.immediate.svg">
				<aside class="notes">
					<ul>
						<li>usando primitivos no compilar칤a el 칰ltimo ejemplo</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Transiciones Inv치lidas</h3>
				<div style="display: flex">
					<div>
						<img class="custom_image" src="./images/long.invalid.transition.svg">
						<h4>Latente</h4>
					</div>
					<div class="hide">
						<img class="custom_image" src="./images/invalid.immediate.svg">
						<h4>Inmediata</h4>
					</div>
					<div class="hide">
						<img class="custom_image" src="./images/impossible.transition.svg">
						<h4>Imposible</h4>
					</div>
				</div>
			</section>

			<section>
				<h3>Transiciones Inv치lidas</h3>
				<div style="display: flex">
					<div>
						<img class="custom_image" src="./images/long.invalid.transition.svg">
						<h4>Latente</h4>
					</div>
					<div>
						<img class="custom_image" src="./images/invalid.immediate.svg">
						<h4>Inmediata</h4>
					</div>
					<div class="hide">
						<img class="custom_image" src="./images/impossible.transition.svg">
						<h4>Imposible</h4>
					</div>
				</div>
			</section>

			<section>
				<h3>Transiciones Inv치lidas</h3>
				<div style="display: flex">
					<div>
						<img class="custom_image" src="./images/long.invalid.transition.svg">
						<h4>Latente</h4>
					</div>
					<div>
						<img class="custom_image" src="./images/invalid.immediate.svg">
						<h4>Inmediata</h4>
					</div>
					<div>
						<img class="custom_image" src="./images/impossible.transition.svg">
						<h4 class="blood">Imposible</h4>
					</div>
				</div>
			</section>

			<section>
				<h2>HACIENDO QUE LOS ESTADOS INVALIDOS (DE JAVASCRIPT) SEAN <span class="blood">IMPOSIBLES DE
						REPRESENTAR</span> </h2>
			</section>

			<section>
				<h2>HACIENDO QUE LOS ESTADOS INVALIDOS (DE <span class="gold">JAVASCRIPT</span>) SEAN IMPOSIBLES DE
					REPRESENTAR</h2>
			</section>

			<section>
				<h2>Errores de Back</h2>
				<h5 class="gray">Ux</h5>
				<img src="images/backend.fails.png">
			</section>

			<section>
				<h2>Errores de Front</h2>
				<h5 class="gray">Ux</h5>
				<img src="images/template_error.png" height="450px">
			</section>

			<section>
				<h2>Errores de Front</h2>
				<h5 class="gray">Ux</h5>
				<img src="images/eternal_spinner.png" height="450px">
			</section>

			<section>
				<h2>Errores de Front</h2>
				<h5 class="gray">Ux</h5>
				<img src="images/done_with_errors.png" height="450px">
			</section>

			<!-- <section>
				<h2>Backend Errors</h2>
				<h5 class="gray">Stack Traces</h5>
				<img src="images/java.stacktrace.png" height="450px">
				<aside class="notes">
					<ul>
						<li>Casi con seguridad presente en un log</li>
					</ul>
				</aside>
			</section>

			<section>
				<h2>Frontend Errors</h2>
				<h5 class="gray">Stack Traces</h5>
				<img src="images/js.stacktrace.png" height="450px">
				<aside class="notes">
					<ul>
						<li>Ocurre en el device del usuario</li>
						<li>Se puede shipear con window.onError (pero hay ciertos issues con los CDN)</li>
						<li>Por lo general minificada. Requiere sourcemaps.</li>
						<li>El modelo asincrono y de callbacks dificulta la lectura (hooks, promesas que se resuelven,
							c칩digo de framework)</li>
					</ul>
				</aside>
			</section> -->

			<!-- merge with up -->

			<section>
				<h2>Diagn칩stico <small>(post)</small></h2>
				<table class="center">
					<thead>
						<tr>
							<th></th>
							<th>Backend</th>
							<th>Frontend</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Stack Traces</td>
							<td>游</td>
							<td>游뱂</td>
						</tr>
						<tr class="fragment">
							<td>Logs</td>
							<td>游</td>
							<td>游뱂</td>
						</tr>
						<tr class="fragment">
							<td>Environment</td>
							<td>游</td>
							<td>游땴</td>
						</tr>
						<tr class="fragment">
							<td>Diagnostic Tools</td>
							<td>游</td>
							<td>游땴</td>
						</tr>
					</tbody>
				</table>
				<aside class="notes">
					<h4>Stack traces</h4>
					<ul>
						<li>Backend, presentes en los logs casi con seguridad</li>
						<li>Frontend, ocurren en el usuario, se pueden enviar al back window.onError</li>
						<li>Frontend, si el script se hostea en CDN hay que configrar headers de allow-origin</li>
						<li>Frontend, motivo del asincronismo (hooks de fwk, promesas, async/await) a veces no son muy
							claras</li>
						<li>Frontend, muy probablemente est칠n minificadas y tengan que traducirse con source maps</li>
					</ul>
					<h4>Logs</h4>
					<ul>
						<li>Backend, casi siempre hay. Pr치ctica madura, con niveles de severidad, appenders, etc. Hot
							reload de severity level</li>
						<li>Frontend, casi nunca hay. Pr치cica ad-hoc.</li>
						<li>Frontend, se puede usar un buffer circular en console.log y enviar en el onErro (mismos
							issues que con las stack traces)</li>
						<li>Backend, muy com칰n tener logs de las dependencias</li>
						<li>Frontend, practicamente imposible (salvo vendoring)</li>
					</ul>
					<h4>Environment</h4>
					<ul>
						<li>Backend, la app corre en un entorno controlado a veces posible de replicar con mucha
							exactitud de manera local(VM, docker, etc)</li>
						<li>Frontend, la app corre en el navegador del usuario, cualquiera sea, con las extensiones y
							restricciones que apliquen. (media queries - netbook)</li>
					</ul>
					<h4>Diagnostic Tools</h4>
					<ul>
						<li>Backend, muchas tools para diagnosticar la app (profiling, pyflames, jvisualvm, flight
							recorder, etc). Adem치s herramientas de diagn칩stico de la m치quina que corre el programa (top,
							vmstat, perf, strace, etc)</li>
						<li>Frontend, nada que se le compare</li>
					</ul>
				</aside>
			</section>

			<section>
				<h3>Transiciones Inv치lidas</h3>
				<div style="display: flex">
					<div style="opacity: 0.3">
						<img class="custom_image" src="./images/long.invalid.transition.svg">
						<h4>Latente</h4>
					</div>
					<div style="opacity: 0.3">
						<img class="custom_image" src="./images/invalid.immediate.svg">
						<h4>Inmediata</h4>
					</div>
					<div style="border: 1px solid gold;">
						<img class="custom_image" src="./images/impossible.transition.svg">
						<h4 style="color: gold">Imposible</h4>
					</div>
				</div>
			</section>

			<section>
				<h3>Previniendo errores</h3>
				<h4 class="gray">necesitamos herramientas</h4>
				<img class="custom_image large" src="images/tools_for_checking_js.svg">
			</section>

			<section>
				<h3>Previniendo errores</h3>
				<h4 class="gray">necesitamos herramientas</h4>
				<img class="custom_image large" src="images/eslint.svg">
			</section>

			<section>
				<h3>Previniendo errores</h3>
				<h4 class="gray">necesitamos herramientas</h4>
				<img class="custom_image large" src="images/ts.svg">
			</section>

			<section>
				<h3>Previniendo errores</h3>
				<h4 class="gray">necesitamos herramientas</h4>
				<img class="custom_image large" src="images/ts2.svg">
			</section>

			<section>
				<h3>TypeScript</h3>
				<ul>
					<li>Microsoft - 2012</li>
					<li class="fragment">Anders Hejlsberg (C#, Delphi, Turbo Pascal)</li>
					<li class="fragment">Muy buen soporte en VsCode</li>
					<li class="fragment">Superset de JavaScript - Gradual Typing</li>
					<li class="fragment">Tipado fuerte</li>
				</ul>
			</section>
			<section>
				<h3>Demo</h3>
				<h4 class="gray">Agregando tipos gradualmente hasta eliminar transiciones inv치lidas</h4>
				<img class="custom_image large" style="margin-top: 100px; width:800px"
					src="images/live.coding.summary.svg">
			</section>

			<section data-background="./images/noideadog.jpg">
				<h1 style="color: #e63f3f">Demo</h1>
				<aside class="notes">
					<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#string-literal-types">
						String Literal Types
					</a>

					<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#union-types">
						Union Types
					</a>

					<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions">
						Discriminated Unions
					</a>

					<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types">
						Mapped Types (Readonly)
					</a>
				</aside>
			</section>

			<section data-background="./images/scales.png"></section>

			<section>
				<h3>Evidencia Anecd칩tica</h3>
				<ul>
					<li>Omnia Salud - EHR. 2014</li>
					<li class="fragment">2 devs</li>
					<li class="fragment">~70k LOC JavaScript / ~15k LOC Scala</li>
					<li class="fragment">90% de los bugs -> <span class="pink"> errores de JavaScript</span></li>
					<li class="fragment">Enviemos los errores por mail en window.onError</li>
					<li class="fragment"><span class="blue">TypeScript 1.X (sin strict mode)</span></li>
					<li class="fragment">Migramos ~70k LOC a TypeScript</li>
					<li class="fragment">De a una funci칩n a la vez</li>
					<li class="fragment"><span class="pink">No m치s errores de front</span></li>
				</ul>
			</section>

			<section>
				<h2>Evidencia Emp칤rica</h2>
				<h6>Cu치l es el porcentaje de bugs <span style="color: gold">publicos</span> que son detectables con
					Flow o
					TypeScript?
				</h6>
				<h6>(2017)</h6>
				<img src="images/gao.paper.png">
			</section>

			<section>
				<h2>Evidencia Emp칤rica</h2>
				<h6>Buscar "fixes"</h6>
				<img src="images/extract.fixes.png">
			</section>

			<section>
				<h2>Evidencia Emp칤rica</h2>
				<h6>Metodolog칤a</h6>
				<img class="fragment" src="images/gao.methodology.gif">
			</section>

			<section>
				<h2>Evidencia Emp칤rica</h2>
				<h6>Hallazgos</h6>
				<ul>
					<li>4M de fixes en c칩digo JavaScript (19/08/2015)</li>
					<li class="fragment">Muestra: 400 fixes (95% / 5%)</li>
					<li class="fragment">Tiempo para lograr el fix: 10 min</li>
					<li class="fragment"><span class="blue">60 bugs</span> detectados s칩lo agregando tipos <span
							class="blue">(15%)</span></li>
					<li class="fragment">Subestimado: bugs p칰blicos, los autores no son expertos, TS 2.0</li>
					<li class="fragment">Token Tax: <span class="blue">2.5 tokens</span></li>
					<li class="fragment">Time Tax: <span class="blue">4 mins</span></li>
				</ul>
			</section>

			<section>
				<h2>Referencias</h2>
				<ul>
					<li><a href="https://danluu.com/empirical-pl">Static vs Dynamic typing review - Dan Luu</li>
					<li><a href="http://ttendency.cs.ucl.ac.uk/projects/type_study/documents/type_study.pdf">To Type or
							Not to Type - Gao, Bird, Barr</a></li>
					<li><a href="https://www.destroyallsoftware.com/compendium/types?share_key=baf6b67369843fa2">Types -
							Gary Bernhardt</a></li>
					<li><a
							href="https://fsharpforfunandprofit.com/posts/designing-with-types-making-illegal-states-unrepresentable/">Designing
							with Types - Scott Wlaschin</a></li>
					<li><a href="https://www.youtube.com/watch?v=ET4kT88JRXs">TypeScript: Static types for JavaScript -
							Anders Hejlsberg</a></li>
				</ul>
			</section>

			<section>
				<h2>Gracias!</h2>
			</section>

			<section>
				<h2>Contacto</h2>
				<img height="100" src="images/twlogo.png">
				<h4><span class="blue">@fernandezpablo</span></h4>
			</section>

			<section>
				<h2>Contacto</h2>
				<img class="custom_image" src="images/despegar.jpg">
				<h5>pablo.fernandez@despegar.com</h5>
			</section>


		</div>
	</div>


	<script src="js/reveal.js"></script>

	<script>
		//
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			hash: true,
			transition: 'none',
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>
</body>

</html>